# Конфигурация

В Детемиро существует второй регистр, содержание которого заполняется из конфигурационного файла, пространства и, 
если установлено, из родительских проектов. Это **конфигурация**.

Её поведение и реализация ничем не отличается от оригинального [регистра](Registry), кроме предопределения значений. 
За счёт этого компоненты Детемиро и его модули могут корректировать своё поведение. 
Например, для модуля, работающего с базой данных в конфигурации можно задать логин и пароль пользователя БД, а также её хост и имя.

## <a name="realisation"></a>Реализация
Конфигурация для ядра представлена классом [registry](https://docs.detemiro.org/api/classes/detemiro.registry.html), и её объект находится в поле [$config](https://docs.detemiro.org/api/classes/detemiro.html#property_config), внутри класса *detemiro*.

## <a name="how2do0"></a>Определение
Во время вызова метода [main](https://docs.detemiro.org/api/classes/detemiro.html#method_main) класса detemiro как раз и происходит заполнение этого регистра.

Существует несколько источников для него.

### <a name="how2do1"></a>1. Конфигурационный файл для пространств одной директории
Это один из самых простых способов: в директории *det-space* проверяется файл *config.json*. Соответственно в нём находится объект (ассоциативный массив), пары *ключ-значение* и попадут также в регистр конфигурации.

Данная конфигурация доступна для всех пространств, использующий эту директорию *det-space*.

**Пример файла det-space/config.json**:

~~~~json
{
    "database"  : {
        "config": "mysql:host=localhost;dbname=test;charset=utf8",
        "prefix": "prefix_",
        "user"  : "test",
        "pass"  : "test"
    },
    "login-life": 2678400,
    "ssl"       : true,
    "rels"      : [
        {
            "method": "require",
            "name"  : "database"
        }
    ]
}
~~~~

### <a name="how2do2"></a>2. Конфигурация в методе main
При инициализации Детемиро через метод [main](https://docs.detemiro.org/api/classes/detemiro.html#method_main) вы можете помещать в него ассоциативный массив, его *ключи-значения*, за исключением значения ключа 'space', попадут в конфигурацию.

**Пример:**

~~~~php
detemiro::main(array(
    'mode' => 'normal'
));
~~~~

### <a name="how2do3"></a>3. Конфигурация пространства

При установке [Пространства](Space) можно задать поле `config` с ассоциативным массивом. Его содержание и попадёт  в конфигурацию.

~~~~json
{
    "code"  : "version-eng",
    "config": {
        "language": "eng",
        "mode"    : "easy-api"
    }
}
~~~~

### <a name="parents"></a>4. Конфигурация родительских проектов

Если в предыдущих пунктах был задан ключ `init` со значением *true*, то в [родительских проектах](Space#parents) будет происходить поиск файла *config.json* из пункта 1.

## <a name="priority"></a>Порядок определения
Заполнение регистра происходит постепенно, с перезаписью предыдущих ключей по следующему порядку и приоритету:

1. Родительская конфигурация
2. Общая конфигурация из *config.json*
3. Конфигурация пространства
4. Конфигурация из метода [main](https://docs.detemiro.org/api/classes/detemiro.html#method_main)

Соответственно результат, полученный из метода main наложится на остальные.