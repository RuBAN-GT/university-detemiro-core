# Пространства

Пространством можно считать ваш проект, а проектом - некое приложение, решающее определённую задачу.  
Т.е. если у вас существует сайт и его AJAX-обработчик, то эти две вещи будут являться разными пространствами. При этом они могут иметь общую конфигурацию, общие модули и находиться в одной директории.

Это необходимо для того, чтобы отдельные компоненты или модули Детемиро могли работать только для определённых пространств. Например, зачем нужен шаблонизатор для консольного обработчика запросов?

## <a name="realisation"></a>Реализация
Пространство для ядра представляется классом [space](https://docs.detemiro.org/api/classes/detemiro.space.html), и его объект находится в поле [$space](https://docs.detemiro.org/api/classes/detemiro.html#property_space), внутри класса *detemiro*.

## <a name="how2do0"></a>Определение
Каждое пространств может иметь свой идентификатор - код. Стандартный код для каждого пространства - `default`. Если вы хотите описать ваше пространство, то есть три пути, и во всех них используется следующий ассоциативный массив (или JSON-объект) в качестве определения:

Поле   | Описание
------ | --------------------------------------------
code   | Код пространства на латинице до 60 символов
name   | Имя пространства (опционально)
config | Уникальная конфигурация для пространства
rels   | Зависимости пространства


### <a name="how2do1"></a>1. Через общий JSON-файл
Определение происходит через файл JSON, который должен находиться в директории *det-space* (в корне проекта) и иметь имя *space.json*.
  
Данный метод подразумевает установку стандартного пространства.

**Простое определение в det-space/space.json:**

~~~~json
{
    "name"  : "Detemiro Project",
    "rels"  : [
        {
            "method": "require",
            "name"  : "router"
        },
        {
            "method": "require",
            "name"  : "theme"
        }
    ]
}
~~~~

При таком определении пространство `default` потребует для своей работы модули *router* и *theme*.

### <a name="how2do2"></a>2. Определение кода пространства через main
Определяется код пространства через метод [main](https://docs.detemiro.org/api/classes/detemiro.html#method_main) класса detemiro внутри поля `space`.

В этом случае будет происходить поиск пространства в файле det-space/space.{значение_поля}.json.

**Пример:**

~~~~php
detemiro::main(array(
    'space' => 'api'
));
~~~~

В этом случае произойдёт поиск файла *det-space/space.api.json*, который может иметь следующий вид:

~~~~json
{
    "code"  : "api",
    "name"  : "API",
    "config": {
        "theme" : "master",
        "page"  : null,
        "mode"  : "easy-api"
    },
    "rels"  : [
        {
            "method": "support",
            "name"  : "router"
        }
    ]
}
~~~~

Данное пространство получит код `api`, перезапишет конфигурационные поля: *theme, page, mode* и потребует модуль *router* для своего запуска.

### <a name="how2do3"></a>3. Определение пространства через main
Определение самого пространства задаётся в виде ассоциативного массива через метод main класса detemiro внутри поля `space`.

**Пример:**

~~~~php
detemiro::main(array(
    'space' => array(
        'code'   => 'specific',
        'config' => array('theme' => 'other')   
    )
));
~~~~

При таком способе установится пространство `specific`, перезаписывающее тему на *other*.

> Для того, чтобы пространство запустилось, необходимо, чтобы произошла успешная [проверка отношений](Relations).

## <a name="parents"></a>Родительские проекты
Если ваш проект находится в директории других проектов (определяется по наличии папки *det-space* у них) 
и в [конфигурации](Config) задано `init == true`, то такие корневые проекты будут являться родительскими, и от них будут унаследованы [общая конфигурация](Config#how2do1) и модули.

## <a name="classload"></a>Подгрузка классов
В Детемиро возможна подгрузка классов в пространстве по следующей схеме: если класс `test` находится в пространстве имён `detemiro\space`, то будет происходить подключение файла *det-includes/__includes/test.php* при его наличии.


## <a name="autoload"></a>Подгрузка
Аналогично [подгрузке событий у Модулей](Modules#autoload) возможна [подгрузка](Autoload) из директории *det-includes/\_\_externals*.